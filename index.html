
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0e0f12" />
  <title>Hiâ€‘Res Web Player</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" href="icons/icon-192.png" sizes="192x192" />
  <link rel="apple-touch-icon" href="icons/icon-512.png" />

  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <h1>Hiâ€‘Res Web Player</h1>
    <div class="actions">
      <button id="openFilesBtn">Ouvrir des fichiers</button>
      <button id="openDirBtn" title="Chromium uniquement">Ouvrir un dossier</button>
      <input id="fileInput" type="file" multiple accept="audio/*" hidden />
    </div>
  </header>

  <main class="layout">
    <section class="playlist">
      <h2>Playlist</h2>
      <ul id="trackList"></ul>
    </section>

    <section class="player">
      <div class="now-playing">
        <div>
          <div id="trackTitle" class="title">â€“</div>
          <div id="trackMeta" class="meta">â€”</div>
        </div>
        <div class="time">
          <span id="currentTime">0:00</span>
          <span> / </span>
          <span id="duration">0:00</span>
        </div>
      </div>

      <input id="seekBar" type="range" min="0" max="1000" value="0" step="1" />

      <div class="controls">
        <button id="prevBtn" aria-label="PrÃ©cÃ©dent">â®</button>
        <button id="playPauseBtn" aria-label="Lecture/Pause">â–¶ï¸</button>
        <button id="nextBtn" aria-label="Suivant">â­</button>
        <label class="volume">
          ğŸ”Š
          <input id="volume" type="range" min="0" max="1" step="0.01" value="0.9" />
        </label>
      </div>

      <div class="tech">
        <span id="sampleInfo">Sample rateâ€¯: â€”</span>
        <span id="ctxState">AudioContextâ€¯: â€”</span>
      </div>

      <details class="panel" id="replaygainPanel">
        <summary>ğŸšï¸ ReplayGain</summary>
        <label class="switch">
          <input type="checkbox" id="rgEnable" />
          <span>Activer ReplayGain (track)</span>
        </label>
        <div class="muted small">Si un tag ReplayGain est prÃ©sent, le niveau est ajustÃ© automatiquement (dB â†’ gain linÃ©aire).</div>
      </details>

      <details class="panel" id="eqPanel">
        <summary>ğŸ›ï¸ Ã‰galiseur (5 bandes)</summary>
        <div class="eq-grid">
          <div class="eq-band">
            <div>60â€¯Hz (lowshelf)</div>
            <input type="range" id="eq0" min="-12" max="12" step="0.5" value="0" />
            <div class="muted"><span id="eq0v">0</span>â€¯dB</div>
          </div>
          <div class="eq-band">
            <div>230â€¯Hz</div>
            <input type="range" id="eq1" min="-12" max="12" step="0.5" value="0" />
            <div class="muted"><span id="eq1v">0</span>â€¯dB</div>
          </div>
          <div class="eq-band">
            <div>910â€¯Hz</div>
            <input type="range" id="eq2" min="-12" max="12" step="0.5" value="0" />
            <div class="muted"><span id="eq2v">0</span>â€¯dB</div>
          </div>
          <div class="eq-band">
            <div>4â€¯kHz</div>
            <input type="range" id="eq3" min="-12" max="12" step="0.5" value="0" />
            <div class="muted"><span id="eq3v">0</span>â€¯dB</div>
          </div>
          <div class="eq-band">
            <div>12â€¯kHz (highshelf)</div>
            <input type="range" id="eq4" min="-12" max="12" step="0.5" value="0" />
            <div class="muted"><span id="eq4v">0</span>â€¯dB</div>
          </div>
        </div>
        <label class="switch">
          <input type="checkbox" id="eqEnable" checked />
          <span>Activer lâ€™Ã©galiseur</span>
        </label>
      </details>

      <canvas id="visualizer" width="960" height="180" aria-label="Visualiseur audio"></canvas>
    </section>
  </main>

  <footer class="foot">
    <small>
      Astuceâ€¯: glissez/dÃ©posez des fichiers. Pour FLAC partout, un dÃ©codeur WASM est intÃ©grÃ©.
      En PWA, lâ€™app est installable et fonctionne horsâ€‘ligne (app shell).
    </small>
  </footer>

  <!-- Libs externes (CDN) : FLAC WASM + metadata (ReplayGain) -->
  <script src="https://cdn.jsdelivr.net/npm/@wasm-audio-decoders/flac@0.2.10/dist/flac-decoder.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/music-metadata-browser/dist/music-metadata-browser.min.js" defer></script>

  <script src="app.js" defer></script>
  <script>
    // Enregistrement Service Worker (PWA)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(console.error);
      });
    }
  </script>
</body>
</html>
